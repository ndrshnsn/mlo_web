{"version":3,"file":"timeout_controller-CeUbkpNf.js","sources":["../../../app/frontend/javascript/controllers/timeout_controller.js"],"sourcesContent":["import { Controller } from \"@hotwired/stimulus\"\nimport Timer from \"easytimer.js\"\n\nexport default class extends Controller {\n  static values = { \n    frequency: String,\n    tpath: String,\n    apath: String,\n    warning: String,\n    modal: String,\n    counter: String\n  }\n\n  connect() {\n    const frequency = this.frequencyValue\n    const apath = this.apathValue\n    const tpath = this.tpathValue\n    const warning = this.warningValue\n    const modal = this.modalValue\n    const counter = document.getElementById(this.counterValue)\n\n    setTimeout(periodicalQuery, (frequency * 1000))\n\n    function periodicalQuery() {\n      var request = new XMLHttpRequest();\n      request.onload = function (event) {\n        var status = event.target.status\n        var response = event.target.response\n        if (status === 200 && (response === false || response === 'false' || response === null)) {\n          window.location.href = tpath\n        }\n      }\n      request.open('GET', apath, true)\n      request.responseType = 'json'\n      request.onload = function(e) {\n        if (this.status == 200) {\n          let modal_el = document.getElementById(modal)\n          if (new Date(this.response.timeout).getTime() < (new Date().getTime() + warning * 1000)) {\n            if (!modal_el.classList.contains('show')) {\n              let show_modal = new bootstrap.Modal(modal_el)\n              show_modal.show()\n\n              var timer = new Timer()\n              timer.start({\n                countdown: true,\n                startValues: [0,30,0,0,0]\n              })\n        \n              timer.addEventListener(\"secondsUpdated\", function (e) {\n                counter.innerHTML =  timer.getTimeValues().toString()\n              })\n                \n              timer.addEventListener('targetAchieved', function (e) {\n                window.location.reload()\n              })\n\n            }\n          }\n        }\n      };\n      request.send();\n      setTimeout(periodicalQuery, (frequency * 1000))\n    }\n  }\n}"],"names":["timeout_controller","Controller","frequency","apath","tpath","warning","modal","counter","periodicalQuery","request","event","status","response","e","modal_el","timer","Timer","__publicField"],"mappings":"8PAGe,MAAKA,UAASC,CAAW,CAUtC,SAAU,CACR,MAAMC,EAAY,KAAK,eACjBC,EAAQ,KAAK,WACbC,EAAQ,KAAK,WACbC,EAAU,KAAK,aACfC,EAAQ,KAAK,WACbC,EAAU,SAAS,eAAe,KAAK,YAAY,EAEzD,WAAWC,EAAkBN,EAAY,GAAM,EAE/C,SAASM,GAAkB,CACzB,IAAIC,EAAU,IAAI,eAClBA,EAAQ,OAAS,SAAUC,EAAO,CAChC,IAAIC,EAASD,EAAM,OAAO,OACtBE,EAAWF,EAAM,OAAO,SACxBC,IAAW,MAAQC,IAAa,IAASA,IAAa,SAAWA,IAAa,QAChF,OAAO,SAAS,KAAOR,EAE1B,EACDK,EAAQ,KAAK,MAAON,EAAO,EAAI,EAC/BM,EAAQ,aAAe,OACvBA,EAAQ,OAAS,SAASI,EAAG,CAC3B,GAAI,KAAK,QAAU,IAAK,CACtB,IAAIC,EAAW,SAAS,eAAeR,CAAK,EAC5C,GAAI,IAAI,KAAK,KAAK,SAAS,OAAO,EAAE,UAAa,IAAI,KAAI,EAAG,QAAS,EAAGD,EAAU,KAC5E,CAACS,EAAS,UAAU,SAAS,MAAM,EAAG,CACvB,IAAI,UAAU,MAAMA,CAAQ,EAClC,KAAM,EAEjB,IAAIC,EAAQ,IAAIC,EAChBD,EAAM,MAAM,CACV,UAAW,GACX,YAAa,CAAC,EAAE,GAAG,EAAE,EAAE,CAAC,CACxC,CAAe,EAEDA,EAAM,iBAAiB,iBAAkB,SAAUF,EAAG,CACpDN,EAAQ,UAAaQ,EAAM,cAAa,EAAG,SAAU,CACrE,CAAe,EAEDA,EAAM,iBAAiB,iBAAkB,SAAUF,EAAG,CACpD,OAAO,SAAS,OAAQ,CACxC,CAAe,CAEF,CAEJ,CACT,EACMJ,EAAQ,KAAI,EACZ,WAAWD,EAAkBN,EAAY,GAAM,CAChD,CACF,CACH,CA5DEe,EADkBjB,EACX,SAAS,CACd,UAAW,OACX,MAAO,OACP,MAAO,OACP,QAAS,OACT,MAAO,OACP,QAAS,MACV"}