import{C as a}from"./application-BzDBbQCT.js";import{p as n}from"./verbs-DNA89zgE.js";import"./fetch_request-Bi6ZTe2Y.js";class v extends a{connect(){this.element.addEventListener("change",function(){t(this.checked)});function t(r){r?o():s()}function o(){navigator.serviceWorker&&Notification.requestPermission().then(r=>{r==="granted"?navigator.serviceWorker.register("/serviceworker.js").then(function(e){return e.pushManager.getSubscription().then(function(i){return i||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:window.vapidPublicKey})})}).then(function(e){n("/notifications/subscribe",{body:{subscription:e.toJSON()},responseKind:"turbo-stream"})}):alert("Notifications declined")}).catch(r=>console.log("Notifications error",r))}function s(){navigator.serviceWorker.ready.then(r=>{r.pushManager.getSubscription().then(e=>{e&&(c(),e.unsubscribe().then(function(){n("/notifications/unsubscribe",{body:{subscription:e.toJSON()},responseKind:"turbo-stream"})}).catch(i=>{logger.error("Error thrown while unsubscribing from push messaging",i)}))})})}function c(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(e=>{e.unregister()})}),navigator.serviceWorker.getRegistrations().then(function(r){for(let e of r)e.unregister()}),window.navigator&&navigator.serviceWorker&&navigator.serviceWorker.getRegistrations().then(function(r){for(let e of r)e.unregister()}),"caches"in window&&caches.keys().then(function(r){return Promise.all(r.map(function(e){return caches.delete(e)}))}),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(r){for(const e of r)console.log("serviceWorker unregistered"),e.unregister(),setTimeout(function(){console.log("trying redirect do"),window.location.replace(window.location.href)},3e3)})}}}export{v as default};
//# sourceMappingURL=notifications_controller-CRdMywqS.js.map
